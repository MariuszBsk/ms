

<div class="result-container">
    <div>
        <h3>Left Cumulation</h3>
        <div id="leftResult" class="result-box" tabindex="0"></div>
    </div>
    <div>
        <h3>Right Cumulation</h3>
        <div id="rightResult" class="result-box" tabindex="0"></div>
    </div>
</div>

<button onclick="showPopup()">Generate Measurements From Image</button>

<div id="popup" class="popup">
    <p>Generate Measurements From Image</p>
    <button onclick="closePopup()">Close</button>
</div>

<script>
    function cumulate(direction) {
        const inputValues = document.getElementById("inputValues").value;
        fetch(`/cumulate?direction=${direction}&values=${inputValues}`)
            .then(response => response.json())
            .then(data => {
                const resultBox = direction === 'left' ? document.getElementById("leftResult") : document.getElementById("rightResult");
                resultBox.innerHTML = ""; // Clear previous results
                
                data.result.forEach((item, index) => {
                    const div = document.createElement("div");
                    div.classList.add("result-item");
                    div.textContent = item;
                    div.dataset.index = index;
                    div.onclick = () => toggleSelection(div);
                    resultBox.appendChild(div);
                });

                // Enable keyboard navigation
                enableKeyboardNavigation(resultBox);
            });
    }

    function toggleSelection(element) {
        element.classList.toggle("highlighted");
    }

    function enableKeyboardNavigation(container) {
        let selectedIndex = -1;
        container.addEventListener("keydown", function(event) {
            const items = this.querySelectorAll(".result-item");
            if (items.length === 0) return;

            if (event.key === "ArrowDown") {
                selectedIndex = selectedIndex < items.length - 1 ? selectedIndex + 1 : 0;
            } else if (event.key === "ArrowUp") {
                selectedIndex = selectedIndex > 0 ? selectedIndex - 1 : items.length - 1;
            } else {
                return; // Ignore other keys
            }

            // Remove previous selection highlight
            items.forEach(item => item.classList.remove("selected"));

            // Mark current selection
            if (items[selectedIndex]) {
                items[selectedIndex].classList.add("selected");
                items[selectedIndex].classList.add("highlighted"); // Turn red
            }

            // Ensure the selected item is visible
            items[selectedIndex].scrollIntoView({ behavior: "smooth", block: "nearest" });

            event.preventDefault();
        });
    }

    function showPopup() {
        document.getElementById("popup").style.display = "block";
    }

    function closePopup() {
        document.getElementById("popup").style.display = "none";
    }
</script>

</body>
</html>
